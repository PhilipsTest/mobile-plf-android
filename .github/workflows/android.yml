name: Android CI-akshay

on:
  push:
    branches: [ akshay-test1 ]

jobs:
  build:

    runs-on: self-hosted

    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0
        clean: true
        submodules: true
        lfs: true

    - name: Build & Test with Gradle
      run: |
        ./gradlew clean 
    
    - name: Build & Test with Gradle
      run: |
        ./gradlew --full-stacktrace assembleRelease referenceApp:testReleaseUnitTest AppInfra:testReleaseUnitTest uAppFwLib:testReleaseUnitTest registrationApi:testReleaseUnitTest product-registration-lib:testReleaseUnitTest iap:testReleaseUnitTest digitalCareUApp:testRelease digitalCare:testRelease mya:testReleaseUnitTest pif:testReleaseUnitTest pim:testReleaseUnitTest conversationalChatBot:testReleaseUnitTest philipsecommercesdk:testReleaseUnitTest mec:testReleaseUnitTest pimApp:testReleaseUnitTest referenceApp:testReleaseUnitTest
    
    - name: path to apk folder
      run: |
        ls ${{github.workspace}}/Source/rap/Source/AppFramework/appFramework/build/outputs/apk/release
    
    - name: Upload a Build Artifact
      uses: actions/upload-artifact@v2.2.0
      with:
        name: sample
        path: ${{github.workspace}}/Source/rap/Source/AppFramework/appFramework/build/outputs/apk/release/*.apk
