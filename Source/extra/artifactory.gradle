apply plugin: 'com.jfrog.artifactory-upload'

group = ext.artifactoryGroup
version = (getLibVersionName(ext.shineLibVersion))

artifactory {
    contextUrl = 'http://maartens-mini.ddns.htc.nl.philips.com:8081/artifactory'
    publish {
        repository {
            repoKey = 'libs-release-local'
            username = 'admin'
            password = 'password'
            publishPom = true
            publishIvy = false
            publishBuildInfo = false

        }
    }
    resolve {
        repository {
            repoKey = 'libs-release-local'
        }
    }
}

task sourceJar(type: Jar) {
    from android.sourceSets.main.java.srcDirs
    classifier 'sources'
}

artifactoryPublish {
    dependsOn sourceJar
}

artifacts {
    archives sourceJar
}

def getLibVersionName(shineLibVersion) {
    def workingBranch = """git rev-parse --abbrev-ref HEAD""".execute().text.trim()
    print "!!!!!!!!! workingBranch=${workingBranch} !!!!!!!!!\n"

    def versionName = "${shineLibVersion}"
    if (!workingBranch.equals('master')) {
        versionName += '.SNAPSHOT'
    }

    print "!!!!!!!!! versionName=${versionName} !!!!!!!!!\n"

    return versionName
}