@startuml

class App {
}

class Appliance {
    + FirmwarePort getFirmwarePort()
}

class FirmwarePort {
    + pushFirmware(final byte[] firmwareData)
    + pullFirmware(String version)
    + cancel()
    + deployFirmware()
    + addFirmwarePortListener(FirmwarePortListener listener)
    + removeFirmwarePortListener(FirmwarePortListener listener)
}
note right: Pushing is from phone to device.\nPulling is from the internet to device.

interface FirmwarePortListener {
    + onProgressUpdated(FirmwarePortProgressType type, int progress)
    + onDownloadingFailed(FirmwarePortException exception)
    + onDownloadingFinished()
    + onDeployFailed(FirmwarePortException exception)
    + onDeployFinished()
}

interface DICommPortListener {
    + onPortUpdate(FirmwarePort port)
    + onPortError(FirmwarePort port, Error error, String errorData)
}

abstract class CommunicationStrategy {
    + getProperties()
    + putProperties()
    + subscribe()
    + unsubscribe()
}


class BleCommunicationStrategy {
}
note left : Subscriptions should be\nimplemented with polling

class LanCommunicationStrategy {
}
note right : Subscriptions should be\nimplemented with udp messages


App -down-> Appliance
App ..|> FirmwarePortListener : implements
Appliance -down-> FirmwarePort
FirmwarePort .. FirmwarePortListener
FirmwarePort .left.> DICommPortListener: has
DICommPortListener -up-> FirmwarePortListener
CommunicationStrategy <|-- LanCommunicationStrategy
CommunicationStrategy <|-- BleCommunicationStrategy
FirmwarePort --> CommunicationStrategy

@enduml